<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Edit DERMS Group</title>
    <script src="/js/jquery-3.4.1.min.js"></script>
    <script>
    var selecteddct;
    $(document).ready(function() {
        var radios = document.getElementsByName("groupBy");
        var val = localStorage.getItem('groupBy');
        for (var i = 0; i < radios.length; i++) {
            if (radios[i].value == val) {
              radios[i].checked = true;
            }
        }
        $('input[name="groupBy"]').on('change', function() {
            localStorage.setItem('groupBy', $(this).val());
            changeDropDownMenu();
        });
        if($('input[name="groupBy"]:checked').length > 0){
            changeDropDownMenu();
        }
    });

    function changeDropDownMenu(){
        var container = document.getElementById("chooseGroupContainer");
        var combobox = document.getElementById("groupChoices");
        if(combobox){
            container.removeChild(combobox);
        }
        let select_group =  document.createElement("select");
        select_group.id = 'groupChoices';
        select_group.name = 'groupChoices';
        select_group.required = true;
        select_group.multiple = false;
        select_group.style = "width: 300px";
        select_group.onchange = function() {groupSelected()};
        container.appendChild(select_group);
        if (document.getElementById('byName').checked) {
            selecteddct = {{names|safe}};
            //addSelections(, select_group);
        }else{
            selecteddct = {{mRIDs|safe}};
            //addSelections({{mRIDs|safe}}, select_group);
        }
        addSelections(selecteddct, select_group);
        groupSelected();
    }

    function addSelections(dct, select_group){
        var option, option_text;
        for (var key in dct){
            //console.log(key)
            option = document.createElement("option");
            option.value = key;
            option_text = document.createTextNode(key);
            option.appendChild(option_text);
            select_group.appendChild(option);
        }
    }

    function groupSelected(){
        let groupid = document.getElementById("groupChoices").value;
        let group = selecteddct[groupid];
        var groupDetail = document.getElementById("groupDetail");
        while (groupDetail.hasChildNodes()) {
            groupDetail.removeChild(groupDetail.lastChild);
        }

        let node = document.createTextNode("Group Name: " + group.name);
        groupDetail.appendChild(node);
        groupDetail.appendChild(document.createElement("br"));
        let node2 = document.createTextNode("Group mRID: " + group.mrid);
        groupDetail.appendChild(node2);
        groupDetail.appendChild(document.createElement("br"));
        groupDetail.appendChild(document.createElement("br"));
        let node3 = document.createTextNode("Devices:");
        groupDetail.appendChild(node3);
        groupDetail.appendChild(document.createElement("br"));
        let devicediv = document.createElement("div");
        groupDetail.appendChild(devicediv);

        let i = 0;
        group.devices.forEach(function(k, v){
            i += 1;
            let newDiv = document.createElement('div');
            newDiv.style="padding-left:30px; float:left; width:400px";
            newDiv.id = "devicemrid_" + i;
            let dnode = document.createTextNode('mRID: ' + k.mRID);
            newDiv.appendChild(dnode);
            devicediv.appendChild(newDiv);
            let newDiv2 = document.createElement('div');
            newDiv2.style="padding-left:30px; float:left;";
            newDiv2.id = "devicename_" + i;
            let dnode2 = document.createTextNode('name: ' + k.name);
            newDiv2.appendChild(dnode2);
            devicediv.appendChild(newDiv2);
            //groupDetail.appendChild(document.createElement("br"));
            //console.log(`Key is ${k} and value is ${v}`)
        });
        let brBeforefunc = document.createElement("br");
        brBeforefunc.style = "clear:both";
        groupDetail.appendChild(brBeforefunc);

        let pfuncs = document.createElement('p');
        pfuncs.id = "funcsLabel";
        let node4 = document.createTextNode("DERFunctions:");
        pfuncs.appendChild(node4);
        groupDetail.appendChild(pfuncs);


        let funcs = group.derFunctions;
        let funcdiv = document.createElement('div');
        funcdiv.style = "padding-left:30px";
        funcdiv.id = "derfunctions";
        pfuncs.appendChild(funcdiv);

        for (var key in funcs){
            console.log(key, funcs[key]);
            addDERfuncCheckbox(key, funcs[key]);
        }

<!--        var edit_button = document.createElement("button");-->
<!--        edit_button.id = "editButton";-->
<!--        edit_button.type = "button";-->
<!--        groupDetail.appendChild(edit_button);-->
<!--        edit_button.onclick = function(){ };-->
<!--        var buttonLabel = document.createTextNode("Edit This Group");-->
<!--        edit_button.appendChild(buttonLabel);-->

//<!--        edit_button.value = "Edit This Group";-->
//<!--        edit_button.form = "modifyGroupContainer";-->
//<!--        groupDetail.appendChild(edit_button);-->
    }

    function addDERfuncCheckbox(k, v){
        let container = document.getElementById("derfunctions");
        let func = document.createElement("input");
        let thisLbl = k;
        func.id = thisLbl;
        func.name = thisLbl;
        func.type = "checkbox";
        func.value = thisLbl;
        container.appendChild(func);
        if(v){
            func.checked = true;
        }

        let funcLabel = document.createElement("label");
        funcLabel.for = func.id;
        let cdnode = document.createTextNode(k);
        funcLabel.appendChild(cdnode);
        container.appendChild(funcLabel);
        container.appendChild(document.createElement("br"));
    }
    </script>
</head>
<body>
<a href="/">Home</a>&nbsp;&nbsp;
<a href="/create_group">Create Group</a>&nbsp;&nbsp;
<a href="/list_groups">List All Groups</a><br />

{% if not groups%}
<h1>No Groups Found</h1>
{% endif %}

<div id="chooseGroupContainer">
    <p>List groups by:</p>
    <input type="radio" id="byName" name="groupBy" value="listGroupsByName">
    <label for="byName">List groups by name</label><br>
    <input type="radio" id="bymRID" name="groupBy" value="listGroupsBymRID">
    <label for="bymRID">List groups by mRID</label><br>
</div>
<form id="modifyGroupContainer">
    <p id="groupDetail" style="width:800px"></p>
    <p style="clear:both;">
        <br>
        <button id="editButton" onclick="">Edit This Group</button>
    </p>
<!--    <input type="submit" value="Edit" name="EditButton">-->
</form>




</body>
</html>